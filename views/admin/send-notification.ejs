<%- include('../partials/header', {title: title, currentPage: currentPage, time: time}) %>

<style>
  .admin-form {
    max-width: 600px; /* Form nh·ªè g·ªçn h∆°n form b√†i vi·∫øt */
    margin: 40px auto;
    padding: 30px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  }
  .form-group { margin-bottom: 20px; }
  .form-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #334155; }
  .form-control {
    width: 100%; padding: 10px 12px;
    border: 1px solid #cbd5e1; border-radius: 6px;
    font-size: 14px; box-sizing: border-box;
    transition: border 0.2s;
  }
  .form-control:focus { border-color: #3b82f6; outline: none; }
  
  .btn-submit {
    width: 100%; padding: 12px;
    background: #2563eb; color: white;
    border: none; border-radius: 6px;
    font-weight: 600; font-size: 16px;
    cursor: pointer; transition: background 0.2s;
  }
  .btn-submit:hover { background: #1d4ed8; }

  .alert-msg { padding: 12px; border-radius: 6px; margin-bottom: 20px; font-size: 14px; }
  .alert-error { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
  .alert-success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
</style>

<div class="container">
    <div class="admin-form">
        <h2 style="text-align: center; margin-bottom: 25px; color: #0f172a;">üì¢ G·ª≠i Th√¥ng B√°o H·ªá Th·ªëng</h2>

        <% if (error) { %>
            <div class="alert-msg alert-error">‚ùå <%= error %></div>
        <% } %>
        <% if (success) { %>
            <div class="alert-msg alert-success">‚úÖ <%= success %></div>
        <% } %>

        <form action="/admin/send-notification" method="POST">
            
            <div class="form-group">
                <label>Ti√™u ƒë·ªÅ th√¥ng b√°o (Ng·∫Øn g·ªçn)</label>
                <input type="text" name="title" class="form-control" placeholder="VD: B·∫£o tr√¨ h·ªá th·ªëng..." required>
            </div>

            <div class="form-group">
                <label>N·ªôi dung chi ti·∫øt</label>
                <textarea name="content" class="form-control" rows="4" placeholder="Nh·∫≠p n·ªôi dung nh·∫Øc nh·ªü..." required></textarea>
            </div>

            <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                <div class="form-group" style="flex: 1;">
                    <label>Lo·∫°i th√¥ng b√°o</label>
                    <select name="type" class="form-control">
                        <option value="info">üîµ Th√¥ng tin (Xanh d∆∞∆°ng)</option>
                        <option value="alert">üî¥ C·∫£nh b√°o (ƒê·ªè)</option>
                        <option value="update">üü¢ C·∫≠p nh·∫≠t (Xanh l√°)</option>
                    </select>
                </div>

                <div class="form-group" style="flex: 1;">
                    <label>ƒê·ªëi t∆∞·ª£ng nh·∫≠n tin</label>
                    
                    <div style="margin-bottom: 10px; display: flex; gap: 15px;">
                        <label style="font-weight: 400; cursor: pointer;">
                            <input type="radio" name="target_mode" value="all" checked onclick="toggleEmailArea(false)"> 
                            T·∫•t c·∫£ (All)
                        </label>
                        <label style="font-weight: 400; cursor: pointer;">
                            <input type="radio" name="target_mode" value="list" onclick="toggleEmailArea(true)"> 
                            Danh s√°ch c·ª• th·ªÉ
                        </label>
                    </div>

                    <div id="email-list-area" style="display: none;">
                        <textarea name="target_emails" class="form-control" rows="3" 
                            placeholder="D√°n danh s√°ch email v√†o ƒë√¢y...&#10;V√≠ d·ª•:&#10;vu.nt1@phongvu.vn&#10;thu.hm@phongvu.vn"></textarea>
                        <small style="color: #64748b; font-size: 11px;">
                            Ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y (,) ho·∫∑c xu·ªëng d√≤ng.
                        </small>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Link ch·ª©c nƒÉng (N·∫øu c√≥)</label>
                <input type="text" name="link" class="form-control" placeholder="VD: /fifo-checking ho·∫∑c /price-battle">
                <small style="color: #64748b;">ƒê·ªÉ tr·ªëng n·∫øu ch·ªâ l√† th√¥ng b√°o vƒÉn b·∫£n.</small>
            </div>

            <button type="submit" class="btn-submit">üöÄ G·ª≠i Ngay</button>
            <div style="text-align: center; margin-top: 15px;">
                <a href="/newsfeed" style="color: #64748b; text-decoration: none; font-size: 14px;">‚Üê Quay l·∫°i B·∫£ng tin</a>
            </div>
        </form>
    </div>
</div>
<script>
                function toggleEmailArea(show) {
                    const area = document.getElementById('email-list-area');
                    if (show) {
                        area.style.display = 'block';
                        area.querySelector('textarea').required = true; // B·∫Øt bu·ªôc nh·∫≠p n·∫øu ch·ªçn list
                    } else {
                        area.style.display = 'none';
                        area.querySelector('textarea').required = false;
                    }
                }
            </script>
<%- include('../partials/footer') %>