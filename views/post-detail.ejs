<%- include('partials/header', {title: title, currentPage: currentPage, time: time}) %>

<style>
  .post-detail-container {
    max-width: 900px;
    margin: 20px auto;
    padding: 32px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .admin-actions {
    display: flex;
    gap: 12px; /* ThÃªm khoáº£ng cÃ¡ch 12px giá»¯a cÃ¡c nÃºt */
    margin-bottom: 20px; /* ThÃªm khoáº£ng cÃ¡ch bÃªn dÆ°á»›i */
  }

  /* TiÃªu Ä‘á» lá»›n */
  .post-detail-container h1 {
    font-size: 32px;
    font-weight: 700;
    margin: 0 0 12px 0;
  }

  /* TiÃªu Ä‘á» phá»¥ */
  .post-detail-container .post-subtitle {
    font-size: 20px;
    color: #6c757d;
    font-weight: 400;
    margin-bottom: 24px;
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 24px;
  }

  /* áº¢nh bÃ¬a */
  .post-cover-image {
    width: 100%;
    height: auto;
    max-height: 450px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 24px;
  }

  /* Ná»˜I DUNG CHÃNH (Tá»« Quill.js) */
  .post-content {
    font-size: 17px;
    line-height: 1.7;
    overflow-wrap: break-word;
    word-break: break-all;
  }
  /* CÄƒn chá»‰nh cÃ¡c thÃ nh pháº§n do Quill táº¡o ra */
  .post-content p {
    margin-bottom: 16px;
  }
  .post-content a {
    color: #0d6efd;
  }
  .post-content blockquote {
    border-left: 4px solid #ccc;
    margin-left: 0;
    padding-left: 16px;
    color: #6c757d;
    font-style: italic;
  }
  .post-content img {
    max-width: 100%;
    height: auto;
    border-radius: 6px;
  }
</style>


<div class="post-detail-container">

  <% if (user && (user.role === 'manager' || user.role === 'admin')) { %>
    <div class="admin-actions">
      <a href="/admin/edit-post/<%= post.id %>" class="btn-edit">
        âœï¸ Sá»­a bÃ i
      </a>

      <a href="#" id="btn-delete" data-id="<%= post.id %>" class="btn-delete">
        ğŸ—‘ï¸ XoÃ¡ bÃ i
      </a>
    </div>
  <% } %>

  <h1><%= post.title %></h1>

  <% if (post.subtitle) { %>
    <p class="post-subtitle"><%= post.subtitle %></p>
  <% } %>

  <% if (post.cover_image_url) { %>
    <img src="<%= post.cover_image_url %>" alt="<%= post.title %>" class="post-cover-image">
  <% } %>

  <div class="post-content">
    <%- post.content %>
  </div>

</div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const deleteButton = document.getElementById('btn-delete');

    if (deleteButton) {
      deleteButton.addEventListener('click', async function(e) {
        e.preventDefault(); // NgÄƒn hÃ nh vi máº·c Ä‘á»‹nh cá»§a tháº» <a>

        const postId = this.getAttribute('data-id');

        // BÆ°á»›c 1: Há»i xÃ¡c nháº­n
        if (!confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n XOÃ VÄ¨NH VIá»„N bÃ i Ä‘Äƒng nÃ y khÃ´ng?')) {
          return; // Náº¿u user báº¥m "Cancel" thÃ¬ dá»«ng láº¡i
        }

        // BÆ°á»›c 2: Gá»­i yÃªu cáº§u XoÃ¡ lÃªn server
        try {
          const response = await fetch('/api/post/delete/' + postId, {
            method: 'DELETE',
            headers: {
              'Accept': 'application/json'
            }
          });

          const result = await response.json();

          if (result.ok) {
            // XoÃ¡ thÃ nh cÃ´ng
            alert('ÄÃ£ xoÃ¡ bÃ i Ä‘Äƒng thÃ nh cÃ´ng!');
            window.location.href = '/newsfeed'; // Chuyá»ƒn vá» trang Báº£ng tin
          } else {
            throw new Error(result.error || 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh');
          }

        } catch (error) {
          console.error('Lá»—i khi xoÃ¡ bÃ i:', error);
          alert('ÄÃ£ xáº£y ra lá»—i: ' + error.message);
        }
      });
    }
  });
</script>


<%- include('partials/footer') %>